<!DOCTYPE html>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<meta name="viewport" content="initial-scale=1.0" />

<style type="text/css">.koka .plaincode, .koka a.pp .pc { display: none; } .koka a.pp { color: inherit; text-decoration: none; }</style>
<link rel="stylesheet" type="text/css" href="styles/koka.css" />

<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Nunito:400,400italic,700,700italic" />
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500,700,400italic" />

<title>task.kk documentation</title>
</head>

<body class="koka doc body madoko">
<pre class="koka source"><span class="comment">/&#42;---------------------------------------------------------------------------
  Copyright 2021-2021, Microsoft Research, Daan Leijen.

    This is free software; you can redistribute it and/or modify it under the
  terms of the Apache License, Version 2.0. A copy of the License can be
  found in the LICENSE file at the root of this distribution.
---------------------------------------------------------------------------&#42;/</span>

<span class="comment">/&#42;
Experimental: Parallel tasks.

Note: very experimental and may not work as intended :-)
See &#96;&#96;test/bench/koka/binarytrees.kk&#96;&#96; for example usage.
&#42;/</span>
<span class="kw">module</span> <a class="pp" href="std_os_task.html#_null_"><span class="mo">std/os/task</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task</span></span></a>

<span class="kw">import</span> <a class="pp" href="std_num_int32.html#_null_"><span class="mo">std/num/int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32</span></span></a>

<span class="comment">// A &#96;:promise&lt;a&gt;&#96; can be &#96;await&#96;ed for a result.
</span><span class="decl-value type" id="type_space_promise"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Promise"><a class="pp" href="std_os_task.html#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>promise: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="std_os_task.html#promise_fs_promise">promise<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">promise<span class="fslash">/</span></span>promise: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">any</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a></span></span>

<span class="tp">noinline</span> <span class="decl-fun" id="unsafe__task"><span class="kw">extern</span> <a class="pp" href="std_os_task.html#unsafe__task">unsafe&#95;task<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe&#95;task: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">work</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">any</span></span></a>( <a class="pp">work<span class="pc">work: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">188</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a>
  c <span class="st">"kk&#95;task&#95;schedule"</span></span>

noinline <span class="decl-fun" id="unsafe__await"><span class="kw">extern</span> <a class="pp" href="std_os_task.html#unsafe__await">unsafe&#95;await<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe&#95;await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">any</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  c <span class="st">"kk&#95;promise&#95;get"</span></span>

<span class="decl-fun" id="prim_task_set_default_concurrency"><span class="kw">extern</span> <a class="pp" href="std_os_task.html#prim_task_set_default_concurrency">prim-task-set-default-concurrency<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>prim<span class="dash">-</span>task<span class="dash">-</span>set<span class="dash">-</span>default<span class="dash">-</span>concurrency: <span class="tp sp">(</span><span class="tp tpp">thread<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">ssize&#95;t</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">thread-count<span class="pc">thread<span class="dash">-</span>count: <span class="tp">ssize&#95;t</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_ssize__t"><span class="tp">ssize&#95;t</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>ssize&#95;t: <span class="co">V</span></span></a>  ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a>
  c <span class="st">"kk&#95;task&#95;set&#95;default&#95;concurrency"</span></span>

<span class="decl-fun" id="task_set_default_concurrency"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#task_set_default_concurrency">task-set-default-concurrency<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>task<span class="dash">-</span>set<span class="dash">-</span>default<span class="dash">-</span>concurrency: <span class="tp sp">(</span><span class="tp tpp">thread<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">thread-count<span class="pc">thread<span class="dash">-</span>count: <span class="tp">int</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_int"><span class="tp">int</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int: <span class="co">V</span></span></a> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">io</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_io"><span class="tp"><span class="effect">io</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>io: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a>
  <a class="pp" href="#prim_task_set_default_concurrency">prim-task-set-default-concurrency<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>prim<span class="dash">-</span>task<span class="dash">-</span>set<span class="dash">-</span>default<span class="dash">-</span>concurrency: <span class="tp sp">(</span><span class="tp tpp">thread<span class="dash">-</span>count</span> <span class="tp kw op">:</span> <span class="tp">ssize&#95;t</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">fsys</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">thread-count<span class="pc">thread<span class="dash">-</span>count: <span class="tp">int</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_int-source.html#ssize__t">ssize&#95;t<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>int<span class="fslash last">/</span></span>ssize&#95;t: <span class="tp sp">(</span><span class="tp tpp">i</span> <span class="tp kw op">:</span> <span class="tp">int</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">alloc</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">console</span><span class="tp sp">,</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">,</span><span class="tp">fsys</span><span class="tp sp">,</span><span class="tp">ndet</span><span class="tp sp">,</span><span class="tp">net</span><span class="tp sp">,</span><span class="tp">read</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">,</span><span class="tp">ui</span><span class="tp sp">,</span><span class="tp">write</span><span class="tp sp">&lt;</span><span class="tp">global</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <span class="tp">ssize&#95;t</span></span></a> </span>)


<span class="comment">// Spark a pure computation in a separate thread of control.
</span><span class="decl-fun" id="task"><span class="kw">pub</span> <span class="kw">noinline</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#task">task<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>task: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">work</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">work<span class="pc">work: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">245</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="number">267</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>promise: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="#con_space_Promise"><span class="co">Promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>Promise: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="#unsafe__task">unsafe&#95;task<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe&#95;task: <span class="tp sp">(</span><span class="tp tpp">work</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">245</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> any</span></a>( <a class="pp">work<span class="pc">work: <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp op">$</span><span class="number">245</span></span></a> ) </span>)

<span class="comment">// Await the result of a promise.
</span><span class="decl-fun" id="await"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">272</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>promise: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="number">292</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  <a class="pp" href="#unsafe__await">unsafe&#95;await<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe&#95;await: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp sp">&lt;</span><span class="tp">div</span><span class="tp sp">,</span><span class="tp">exn</span><span class="tp sp">&gt;</span> <span class="tp op">$</span><span class="number">272</span></span></a>( <a class="pp">p<span class="pc">p: <span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">272</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#promise_fs_promise">promise<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">promise<span class="fslash">/</span></span>promise: <span class="tp sp">(</span><span class="tp tpp">promise</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">272</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> any</span></a> </span>)

<span class="comment">// Await the result of a list of promises.
</span><span class="decl-fun" id="list_fs_await"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#list_fs_await">list/await<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">list<span class="fslash">/</span></span>await: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">ps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">promise</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">ps<span class="pc">ps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">297</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>list: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp" href="#type_space_promise"><span class="tp">promise</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>promise: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span><span class="tp sp">&gt;</span> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="number">344</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>list: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp">ps<span class="pc">ps: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">297</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_list-source.html#map">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>list<span class="fslash last">/</span></span>map: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">297</span><span class="op">&gt;</span><span class="op">&gt;</span>, f <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">297</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> <span class="op">$</span><span class="number">297</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> list<span class="op">&lt;$</span><span class="number">297</span><span class="op">&gt;</span></span></a>(<a class="pp" href="#await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>await: <span class="tp sp">(</span><span class="tp tpp">p</span> <span class="tp kw op">:</span> <span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">297</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> <span class="op">$</span><span class="number">297</span></span></a></span>)

<span class="comment">// Run a list of pure computations in parallel.
</span><span class="decl-fun" id="parallel"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#parallel">parallel<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>parallel: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">349</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>list: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="number">426</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_list"><span class="tp">list</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>list: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp">xs<span class="pc">xs: <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">349</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="std_core_list-source.html#map">map<span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>list<span class="fslash last">/</span></span>map: <span class="tp sp">(</span><span class="tp tpp">xs</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">349</span><span class="op">&gt;</span>, f <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">349</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> promise<span class="op">&lt;$</span><span class="number">349</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> list<span class="op">&lt;</span>promise<span class="op">&lt;$</span><span class="number">349</span><span class="op">&gt;</span><span class="op">&gt;</span></span></a>( <a class="pp" href="#task">task<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>task: <span class="tp sp">(</span><span class="tp tpp">work</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp op">$</span><span class="number">349</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> promise<span class="op">&lt;$</span><span class="number">349</span><span class="op">&gt;</span></span></a> )<span class="kw op">.</span><a class="pp" href="#list_fs_await">await<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">list<span class="fslash">/</span></span>await: <span class="tp sp">(</span><span class="tp tpp">ps</span> <span class="tp kw op">:</span> <span class="tp">list</span><span class="tp sp">&lt;</span><span class="tp">promise</span><span class="tp op">&lt;$</span><span class="number">349</span><span class="op">&gt;</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> list<span class="op">&lt;$</span><span class="number">349</span><span class="op">&gt;</span></span></a></span>


<span class="comment">/&#42;
noinline extern unsafe&#95;task&#95;n( count : ssize&#95;t, stride : ssize&#95;t, work : () -&gt; pure a, combine : (a,a) -&gt; a ) : pure any
  c "kk&#95;task&#95;schedule&#95;n"

pub noinline fun taskn( count : int, stride : int, work : () -&gt; pure a, combine : (a,a) -&gt; total a ) : pure promise&lt;a&gt;
  Promise( unsafe&#95;task&#95;n( count.ssize&#95;t, stride.ssize&#95;t, work, combine ) )

&#42;/</span>

<span class="comment">// ---------------------------------------------------------
// LVar's
// Note: currently unsafe in the pure effect!! needs work
</span>
<span class="decl-value type" id="type_space_lvar"><span class="kw">abstract</span> <span class="tp kw">struct</span> <span class="decl-con" id="con_space_Lvar"><a class="pp" href="std_os_task.html#type_space_lvar"><span class="tp">lvar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>lvar: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="std_os_task.html#lvar_fs_lv">lv<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">lvar<span class="fslash">/</span></span>lv: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">lvar</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">any</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a></span></span>

<span class="tp">noinline</span> <span class="decl-fun" id="unsafe_lvar"><span class="kw">extern</span> <a class="pp" href="std_os_task.html#unsafe_lvar">unsafe-lvar<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>lvar: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">init</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">any</span></span></a>( <a class="pp">init<span class="pc">init: <span class="tp op">$</span><span class="number">431</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a>
  c <span class="st">"kk&#95;lvar&#95;alloc"</span></span>

noinline <span class="decl-fun" id="unsafe_put"><span class="kw">extern</span> <a class="pp" href="std_os_task.html#unsafe_put">unsafe-put<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>put: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">monotonic<span class="dash">-</span>combine</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">lvar<span class="pc">lvar: <span class="tp">any</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a>, <a class="pp">x<span class="pc">x: <span class="tp op">$</span><span class="number">450</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>, <a class="pp">monotonic-combine<span class="pc">monotonic<span class="dash">-</span>combine: <span class="tp sp">(</span><span class="tp op">$</span><span class="number">450</span>, <span class="op">$</span><span class="number">450</span>) <span class="kw op">-></span> <span class="op">$</span><span class="number">450</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core_types-source.html#type_space_total"><span class="tp"><span class="effect">a</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>total: <span class="co">E</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a>
  c <span class="st">"kk&#95;lvar&#95;put"</span></span>

noinline <span class="decl-fun" id="unsafe_get"><span class="kw">extern</span> <a class="pp" href="std_os_task.html#unsafe_get">unsafe-get<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">,</span> <span class="tp tpp">bot</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">is<span class="dash">-</span>gte</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">int32</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span></span></a>( <a class="pp">lvar<span class="pc">lvar: <span class="tp">any</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core_types-source.html#type_space_any"><span class="tp">any</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>any: <span class="co">V</span></span></a>, <a class="pp">bot<span class="pc">bot: <span class="tp op">$</span><span class="number">473</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>, <a class="pp">is-gte<span class="pc">is<span class="dash">-</span>gte: <span class="tp sp">(</span><span class="tp op">$</span><span class="number">473</span>, <span class="op">$</span><span class="number">473</span>) <span class="kw op">-></span> int32</span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core_types-source.html#type_space_int32"><span class="tp">int32</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>int32: <span class="co">V</span></span></a> ) <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  c <span class="st">"kk&#95;lvar&#95;get"</span></span>

<span class="decl-fun" id="lvar"><span class="kw">pub</span> <span class="kw">noinline</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#lvar">lvar<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>lvar: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">init</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">lvar</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp">init<span class="pc">init: <span class="tp op">$</span><span class="number">496</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp">lvar</span><span class="tp sp">&lt;</span><span class="number">516</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="#type_space_lvar"><span class="tp">lvar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>lvar: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>
  <a class="pp" href="#con_space_Lvar"><span class="co">Lvar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>Lvar: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">lv</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">lvar</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span></span></a>( <a class="pp" href="#unsafe_lvar">unsafe-lvar<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>lvar: <span class="tp sp">(</span><span class="tp tpp">init</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">496</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> any</span></a>(<a class="pp">init<span class="pc">init: <span class="tp op">$</span><span class="number">496</span></span></a>) </span>)

<span class="decl-fun" id="put"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#put">put<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>put: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">lvar</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">monotonic<span class="dash">-</span>combine</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a>( <a class="pp">lvar<span class="pc">lvar: <span class="tp">lvar</span><span class="tp op">&lt;$</span><span class="number">521</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_lvar"><span class="tp">lvar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>lvar: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">x<span class="pc">x: <span class="tp op">$</span><span class="number">521</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>, <a class="pp">monotonic-combine<span class="pc">monotonic<span class="dash">-</span>combine: <span class="tp sp">(</span><span class="tp op">$</span><span class="number">521</span>, <span class="op">$</span><span class="number">521</span>) <span class="kw op">-></span> <span class="op">$</span><span class="number">521</span></span></a> <span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core_types-source.html#type_space_total"><span class="tp"><span class="effect">a</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>total: <span class="co">E</span></span></a> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp sp">(</span><span class="tp sp">)</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">(</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a><a class="pp" href="std_core_types-source.html#type_space_unit"><span class="tp">)</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>unit: <span class="co">V</span></span></a>
  <a class="pp" href="#unsafe_put">unsafe-put<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>put: <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">,</span> <span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">521</span>, monotonic<span class="dash">-</span>combine <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp op">$</span><span class="number">521</span>, <span class="op">$</span><span class="number">521</span>) <span class="kw op">-></span> <span class="op">$</span><span class="number">521</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> ()</span></a>( <a class="pp">lvar<span class="pc">lvar: <span class="tp">lvar</span><span class="tp op">&lt;$</span><span class="number">521</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#lvar_fs_lv">lv<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">lvar<span class="fslash">/</span></span>lv: <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">lvar</span><span class="tp op">&lt;$</span><span class="number">521</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> any</span></a>, <a class="pp">x<span class="pc">x: <span class="tp op">$</span><span class="number">521</span></span></a>, <a class="pp">monotonic-combine<span class="pc">monotonic<span class="dash">-</span>combine: <span class="tp sp">(</span><span class="tp op">$</span><span class="number">521</span>, <span class="op">$</span><span class="number">521</span>) <span class="kw op">-></span> <span class="op">$</span><span class="number">521</span></span></a> </span>)

<span class="decl-fun" id="get"><span class="kw">pub</span> <span class="kw">fun</span> <a class="pp" href="std_os_task.html#get">get<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>get: <span class="tp kw">forall</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span> <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">lvar</span><span class="tp sp">&lt;</span><span class="tp tv">a</span><span class="tp sp">&gt;</span><span class="tp sp">,</span> <span class="tp tpp">bot</span> <span class="tp kw op">:</span> <span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tpp">is<span class="dash">-</span>gte</span> <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp tv">a</span><span class="tp sp">,</span> <span class="tp tv">a</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">bool</span><span class="tp sp">)</span> <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="tp tv">a</span></span></a>( <a class="pp">lvar<span class="pc">lvar: <span class="tp">lvar</span><span class="tp op">&lt;$</span><span class="number">550</span><span class="op">&gt;</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="#type_space_lvar"><span class="tp">lvar</span><span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>lvar: <span class="co">V</span> <span class="kw op">-></span> <span class="co">V</span></span></a><span class="tp sp">&lt;</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">&gt;</span>, <a class="pp">bot<span class="pc">bot: <span class="tp op">$</span><span class="number">550</span></span></a> <span class="tp kw op">:</span> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>, <a class="pp">is-gte<span class="pc">is<span class="dash">-</span>gte: <span class="tp sp">(</span><span class="tp op">$</span><span class="number">550</span>, <span class="op">$</span><span class="number">550</span>) <span class="kw op">-></span> bool</span></a><span class="tp kw op">:</span> <span class="tp sp">(</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">,</span><a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a><span class="tp sp">)</span> <span class="tp kw op">-></span> <a class="pp" href="std_core_types-source.html#type_space_bool"><span class="tp">bool</span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash">/</span>types<span class="fslash last">/</span></span>bool: <span class="co">V</span></span></a> <a class="pp">)<span class="pc">result: <span class="tp kw op">-></span> <span class="tp">pure</span> <span class="number">583</span></span></a> <span class="tp kw op">:</span> <a class="pp" href="std_core-source.html#type_space_pure"><span class="tp"><span class="effect">pure</span></span><span class="pc"><span class="mo">std<span class="fslash">/</span>core<span class="fslash last">/</span></span>pure: <span class="co">E</span></span></a> <a class="pp"><span class="tp tv">a</span><span class="pc">a: <span class="co">V</span></span></a>
  <a class="pp" href="#unsafe_get">unsafe-get<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span>unsafe<span class="dash">-</span>get: <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">any</span><span class="tp sp">,</span> <span class="tp tpp">bot</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">550</span>, is<span class="dash">-</span>gte <span class="tp kw op">:</span> <span class="tp sp">(</span><span class="tp op">$</span><span class="number">550</span>, <span class="op">$</span><span class="number">550</span>) <span class="kw op">-></span> int32) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> <span class="op">$</span><span class="number">550</span></span></a>( <a class="pp">lvar<span class="pc">lvar: <span class="tp">lvar</span><span class="tp op">&lt;$</span><span class="number">550</span><span class="op">&gt;</span></span></a><span class="kw op">.</span><a class="pp" href="#lvar_fs_lv">lv<span class="pc"><span class="mo">std<span class="fslash">/</span>os<span class="fslash">/</span>task<span class="fslash last">/</span></span><span class="lq">lvar<span class="fslash">/</span></span>lv: <span class="tp sp">(</span><span class="tp tpp">lvar</span> <span class="tp kw op">:</span> <span class="tp">lvar</span><span class="tp op">&lt;$</span><span class="number">550</span><span class="op">&gt;</span>) <span class="kw op">-></span> <span class="op">&lt;</span>div,exn<span class="op">&gt;</span> any</span></a>, <a class="pp">bot<span class="pc">bot: <span class="tp op">$</span><span class="number">550</span></span></a>, <a class="pp"><span class="kw">fn</span><span class="pc">fn: <span class="tp sp">(</span><span class="tp tpp">x</span> <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">550</span>, y <span class="tp kw op">:</span> <span class="tp op">$</span><span class="number">550</span>) <span class="kw op">-></span> int32</span></a>(<a class="pp">x<span class="pc">x: <span class="tp op">$</span><span class="number">550</span></span></a>,<a class="pp">y<span class="pc">y: <span class="tp op">$</span><span class="number">550</span></span></a>){ <span class="kw">if</span> (<a class="pp">is-gte<span class="pc">is<span class="dash">-</span>gte: <span class="tp sp">(</span><span class="tp op">$</span><span class="number">550</span>, <span class="op">$</span><span class="number">550</span>) <span class="kw op">-></span> bool</span></a>(<a class="pp">x<span class="pc">x: <span class="tp op">$</span><span class="number">550</span></span></a>,<a class="pp">y<span class="pc">y: <span class="tp op">$</span><span class="number">550</span></span></a>)) <span class="kw">then</span> <a class="pp" href="std_num_int32-source.html#one">one<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>one: <span class="tp">int32</span></span></a> <span class="kw">else</span> <a class="pp" href="std_num_int32-source.html#zero">zero<span class="pc"><span class="mo">std<span class="fslash">/</span>num<span class="fslash">/</span>int32<span class="fslash last">/</span></span>zero: <span class="tp">int32</span></span></a> } </span>)

</pre>

</body>
</html>
